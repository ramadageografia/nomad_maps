<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="assets/JS/trance-map.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Iniciando mapa Nomad-Maps...');
    
    // Inicializar mapa
    const map = L.map('map').setView([-14.2350, -51.9253], 4);
    
    // Adicionar camada do mapa
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Verificar se os dados carregaram
    console.log('Dados carregados:', window.festivalsData);
    
    if (window.festivalsData && window.festivalsData.length > 0) {
        console.log(`ğŸª Encontrados ${window.festivalsData.length} festivais`);
        
        // Adicionar marcadores
        window.festivalsData.forEach(festival => {
            if (festival.latitude && festival.longitude) {
                const lat = parseFloat(festival.latitude);
                const lng = parseFloat(festival.longitude);
                
                // Criar marcador colorido
                const marker = L.circleMarker([lat, lng], {
                    radius: 8,
                    fillColor: festival.status === 'Ativo' ? '#ff00cc' : '#666666',
                    color: '#ffffff',
                    weight: 2,
                    fillOpacity: 0.8
                }).addTo(map);
                
                // Popup estilizado
                const popupContent = `
                    <div style="color: #0f0c29; min-width: 250px; font-family: Arial, sans-serif;">
                        <h3 style="color: #6a11cb; margin-bottom: 10px; border-bottom: 2px solid #ff00cc; padding-bottom: 5px;">
                            ${festival.nome}
                        </h3>
                        <p><strong>ğŸ“ ${festival.cidade}, ${festival.pais}</strong></p>
                        <p>ğŸ“… ${festival.mes_temporada || 'Data a confirmar'}</p>
                        <p>ğŸŒ ${festival.continente}</p>
                        <p>ğŸµ ${festival.subgeneros ? festival.subgeneros.join(', ') : 'Psytrance'}</p>
                        <p>${festival.status === 'Ativo' ? 'ğŸŸ¢ Ativo' : 'âš« Inativo'}</p>
                        ${festival.link ? `<p><a href="${festival.link}" target="_blank" style="color: #2575fc;">ğŸ”— Site oficial</a></p>` : ''}
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                
                // Efeito hover
                marker.on('mouseover', function() {
                    this.openPopup();
                });
            }
        });
        
    } else {
        console.error('âŒ Nenhum dado carregado do trance-map.js');
        
        // Marcadores de teste para verificar se o mapa funciona
        const testLocations = [
            { name: "SÃ£o Paulo", lat: -23.5505, lng: -46.6333 },
            { name: "Rio de Janeiro", lat: -22.9068, lng: -43.1729 },
            { name: "Lisboa", lat: 38.7223, lng: -9.1393 }
        ];
        
        testLocations.forEach(location => {
            const marker = L.marker([location.lat, location.lng]).addTo(map);
            marker.bindPopup(`<strong>${location.name}</strong><br>Local de teste - Verifique o trance-map.js`);
        });
        
        alert('Mapa carregado, mas festivais nÃ£o encontrados. Verifique o console.');
    }
});
</script>
